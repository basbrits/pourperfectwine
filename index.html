<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Pairing App - Quick Match</title>
    <style>
        /* BASIC STYLING */
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        
        /* TAB NAVIGATION STYLES */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        
        /* Style for the active tab (Quick) */
        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            font-weight: bold;
            color: #555;
            text-decoration: none; /* For the link */
        }
        
        .tab-button.active {
            background-color: #f9f9f9;
            border-color: #ddd;
            border-bottom-color: #fff; /* Blends with content */
            color: #000;
            margin-bottom: -2px; /* Overlaps border */
        }

        /* Style for the link tab (Advanced) */
        a.tab-button {
            background-color: #eef; /* Slight blue tint to indicate link */
        }
        a.tab-button:hover {
            background-color: #dde;
        }

        /* CONTENT AREAS */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* APP ELEMENTS */
        .emoji-button { 
            display: block; 
            width: 100%; 
            padding: 10px; 
            margin: 5px 0; 
            text-align: left; 
            cursor: pointer;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .emoji-button:hover { background-color: #f0f0f0; }
        .emoji-button.multi-select-active {
            background-color: #d1e7dd;
            border-color: #0f5132;
        }
        
        #breadcrumbs { margin-bottom: 15px; font-size: 0.9em; color: #666; }
        .breadcrumb-item { display: inline-block; margin-right: 5px; cursor: pointer; color: blue; text-decoration: underline; }
        
        #result { 
            display: none; 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            border: 1px solid #ddd; 
        }
        .rationale { font-style: italic; color: #555; margin-top: 10px; }
        #multi-warning { color: red; display: none; margin-bottom: 5px; }
        #next-step-btn { display: none; margin-top: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="tabs">
        <div class="tab-button active">Quick Match</div>
        
        <a href="advanced-page.html" class="tab-button">Advanced Mode üîó</a>
    </div>

    <div id="quick-content" class="tab-content active">
        <h2 id="res-title" style="display:none;">Pairing Result</h2>
        
        <div id="steps-container">
            <div id="breadcrumbs"></div>
            <h3 id="step-prompt">Choose Cuisine Style:</h3>
            <div id="multi-warning">Select up to 2 items, then click Next.</div>
            <div id="button-options-container">
                </div>
            <button id="next-step-btn">Next Step &rarr;</button>
        </div>

        <div id="result">
            </div>
    </div>

    <script>
        // ==========================================
        // DATA STRUCTURE
        // ==========================================
        
        // **IMPORTANT:** PASTE YOUR FULL JSON DATA HERE
        const winePairings = {
            "Italian": { 
                "user_label": "Italian", 
                "emoji": "üçù",
                "options": {
                    // ... Your Italian Data ...
                }
            },
            // ... Your Other Cuisines ...
        };

        // ==========================================
        // STATE MANAGEMENT
        // ==========================================
        let currentPath = []; 
        let currentOptions = winePairings; 
        
        // Multi-select state
        let multiSelectMode = false;
        let selectedMultiOptions = [];

        // DOM Elements
        const breadcrumbsDiv = document.getElementById('breadcrumbs');
        const optionsContainer = document.getElementById('button-options-container');
        const stepPrompt = document.getElementById('step-prompt');
        const nextBtn = document.getElementById('next-step-btn');
        const warningMsg = document.getElementById('multi-warning');
        const resultDiv = document.getElementById('result');
        const resultTitle = document.getElementById('res-title');
        const stepsContainer = document.getElementById('steps-container');

        // ==========================================
        // CORE LOGIC FUNCTIONS
        // ==========================================

        function init() {
            // No need to setup Advanced inputs anymore!
            // Start Quick Tab Logic immediately
            resetApp();
        }

        // --- Breadcrumbs ---
        function updateBreadcrumbs() {
            breadcrumbsDiv.innerHTML = '';
            
            const homeBtn = document.createElement('div');
            homeBtn.className = 'breadcrumb-item';
            homeBtn.innerHTML = 'üè† Start';
            homeBtn.onclick = () => resetApp();
            breadcrumbsDiv.appendChild(homeBtn);

            currentPath.forEach((step, index) => {
                const badge = document.createElement('div');
                badge.className = 'breadcrumb-item';
                badge.textContent = step.label;
                badge.onclick = () => handleBreadcrumbClick(index);
                breadcrumbsDiv.appendChild(badge);
            });
        }

        function handleBreadcrumbClick(index) {
            let ptr = winePairings;
            for(let i=0; i<index; i++) { 
                let key = currentPath[i].id.includes('+') ? currentPath[i].id.split('+')[0] : currentPath[i].id;
                
                if (ptr.options && ptr.options[key]) {
                    ptr = ptr.options[key];
                } else if (ptr[key]) {
                     ptr = ptr[key];
                } else if (ptr.type === 'multi_select') {
                    ptr = ptr.options[key];
                }
            }
            
            currentPath = currentPath.slice(0, index);
            currentOptions = ptr;

            resultDiv.style.display = 'none';
            resultTitle.style.display = 'none';
            stepsContainer.style.display = 'block'; 
            
            if (currentPath.length === 0) {
                renderOptions(winePairings, "1. Choose Cuisine Style:");
            } else {
                renderOptions(currentOptions.options || currentOptions, currentOptions.next_prompt || "Choose:");
            }
        }
        
        function resetApp() {
            currentPath = [];
            currentOptions = winePairings;
            resultDiv.style.display = 'none';
            resultTitle.style.display = 'none';
            stepsContainer.style.display = 'block'; 
            
            const oldReset = document.getElementById('reset-button');
            if(oldReset) oldReset.remove();

            document.querySelectorAll('.multi-select-active').forEach(btn => btn.classList.remove('multi-select-active'));

            renderOptions(winePairings, "1. Choose Cuisine Style:");
        }

        // --- Render Logic ---
        function renderOptions(optionsObj, promptText) {
            updateBreadcrumbs();
            optionsContainer.innerHTML = '';
            stepPrompt.textContent = promptText;
            
            multiSelectMode = false;
            selectedMultiOptions = [];
            nextBtn.style.display = 'none';
            warningMsg.style.display = 'none';

            if (currentOptions.type === 'multi_select') {
                renderMultiSelect(currentOptions);
                return;
            }

            const keys = Object.keys(optionsObj).filter(k => k !== 'type' && k !== 'next_prompt' && k !== 'next_prompt_after_multi' && k !== 'choices' && k !== 'user_label' && k !== 'emoji');

            keys.forEach(key => {
                const btn = document.createElement('button');
                btn.className = 'emoji-button';
                
                let data = optionsObj[key];
                let label = data.user_label || key;
                let emoji = data.emoji || getEmoji(key); 

                btn.innerHTML = `<span class="emoji">${emoji}</span> ${label}`;
                btn.onclick = () => handleSelection(key, label);
                optionsContainer.appendChild(btn);
            });
        }

        function renderMultiSelect(data) {
            multiSelectMode = true;
            stepPrompt.textContent = data.next_prompt;
            
            const choices = data.choices; 
            Object.keys(choices).forEach(code => {
                const btn = document.createElement('button');
                btn.className = 'emoji-button';
                btn.innerHTML = `<span class="emoji">üç≤</span> ${choices[code]}`;
                btn.dataset.code = code;
                
                btn.onclick = () => {
                    if (selectedMultiOptions.includes(code)) {
                        selectedMultiOptions = selectedMultiOptions.filter(c => c !== code);
                        btn.classList.remove('multi-select-active');
                    } else {
                        if (selectedMultiOptions.length < 2) {
                            selectedMultiOptions.push(code);
                            btn.classList.add('multi-select-active');
                        } else {
                            warningMsg.style.display = 'block';
                            setTimeout(() => warningMsg.style.display = 'none', 2000);
                        }
                    }
                };
                optionsContainer.appendChild(btn);
            });

            nextBtn.style.display = 'inline-block';
            nextBtn.onclick = handleMultiSelectSubmit;
        }

        // --- Handler Logic ---
        function handleSelection(key, label) {
            let nextNode = currentOptions.options ? currentOptions.options[key] : currentOptions[key];
            
            if (!nextNode || nextNode.user_label === "Not Implemented Yet") {
                alert("Data coming soon for this path!");
                return;
            }

            currentPath.push({ id: key, label: label });
            currentOptions = nextNode;

            if (currentOptions.result_specific) {
                displayResult(currentOptions);
            } else {
                if (currentOptions.type === 'multi_select') {
                    renderMultiSelect(currentOptions);
                } else {
                    renderOptions(currentOptions.options || currentOptions, currentOptions.next_prompt);
                }
            }
        }

        function handleMultiSelectSubmit() {
            if (selectedMultiOptions.length === 0) {
                warningMsg.style.display = 'block';
                return;
            }

            selectedMultiOptions.sort();
            let comboKey = selectedMultiOptions.join('+');
            
            let nextNode = currentOptions.options[comboKey];
            
            if (!nextNode && selectedMultiOptions.length > 0) {
                 nextNode = currentOptions.options[selectedMultiOptions[0]];
            }
            
            if (!nextNode && currentOptions.options['default']) {
                nextNode = currentOptions.options['default'];
            }

            if (!nextNode) {
                alert("Combination not found in data. Try a single selection.");
                return;
            }

            let readableLabel = selectedMultiOptions.map(c => currentOptions.choices[c]).join(" + ");

            currentPath.push({ id: comboKey, label: readableLabel });
            currentOptions = nextNode;

            if (currentOptions.result_specific) {
                displayResult(currentOptions);
            } else {
                renderOptions(currentOptions.options || currentOptions, currentOptions.next_prompt || "Choose Preparation:");
            }
        }

        function displayResult(data) {
            updateBreadcrumbs();
            stepsContainer.style.display = 'none';
            resultDiv.style.display = 'block';
            resultTitle.style.display = 'block';
            
            let html = `
                <p>The **Absolute Best Pairing** is: <br><strong>${data.result_specific}</strong></p>
                <p style="margin-top: 15px;">A great **Available Alternative** is: <br><strong>${data.result_general}</strong></p>
                <div class="rationale">Rationale: ${data.rationale}</div>
                <button id="reset-button" onclick="resetApp()">Start Over ‚Ü∫</button>
            `;
            
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            resultDiv.innerHTML = html;
        }

        // --- Helper for Emoji ---
        function getEmoji(key) {
            if (key.includes("Pasta")) return "üçù";
            if (key.includes("Risotto")) return "üçö";
            if (key.includes("Meat") || key.includes("Beef")) return "ü•©";
            if (key.includes("Fish") || key.includes("Seafood")) return "üêü";
            if (key.includes("Pizza")) return "üçï";
            if (key.includes("Vegetarian")) return "ü•ï";
            if (key.includes("Cheese")) return "üßÄ";
            if (key.includes("Spread")) return "ü¶É";
            if (key.includes("Turkey")) return "üçó";
            if (key.includes("Course")) return "üçΩÔ∏è";
            if (key.includes("Amuse")) return "ü•Ç";
            if (key.includes("Heavy") || key.includes("Roasted")) return "üî•";
            if (key.includes("Light") || key.includes("Fresh")) return "üçÉ";
            return "üç∑";
        }

        // Start App
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
